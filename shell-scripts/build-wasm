#!/usr/bin/env bash
set -eu

# if there's already a container with the same name, remove it (it's probably from the last time we ran this script)
if [[ $(docker ps -aq --filter 'name=wasm-builder') ]]
then
  docker rm wasm-builder
fi

# clear output directory on host
rm -rf wasm/output

# compile C source to wasm on docker container
docker run -it --name wasm-builder --mount source=wasm-output,target=/wasm-output wasm-builder-image /bin/bash

# copy output onto host
docker cp wasm-builder:/wasm-output ./wasm/output
